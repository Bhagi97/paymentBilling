<div class="page-title">
                            <div class="title_left">
                                  <h3 style="margin-left:20px;">Prescription</h3>
                            </div>
                             <div class="title_right">
                                <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                                    <form action="prescription_new.html" method="get">
                                    <div class="input-group">
                                        <input class="form-control" name="q" id="q" placeholder="Patient ID" type="text" >
                                        <span class="input-group-btn">
                                           <button class="btn btn-default" type="submit">Go!</button>
                                        </span>

                                    </div>
                                    </form>
                                </div>
                            </div>
</div>

    <div class="clearfix"></div>

{% if patientphone %}
<div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>Patient details </h2>
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <br />
                    <form id="patientdetails" class="form-horizontal form-label-left"> {% csrf_token %}
                      <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="named">Name <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <input type="text" id="named" name="named" value="{{patientname}}" class="form-control col-md-7 col-xs-12" readonly>
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="ccoded">Patient ID <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <input type="text" id="ccoded" name="ccoded" value="{{patientID}}"  class="form-control col-md-7 col-xs-12" readonly>
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="phonenod">Phone No. <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <input type="text" id="phonenod" name="phonenod" value="{{patientphone}}" class="form-control col-md-7 col-xs-12" readonly>
                        </div>
                      </div>
                      <div class="ln_solid"></div>

                    </form>
                  </div>
                </div>
              </div>
</div>





<div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>Prescribe</h2>
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <br />




                    <form id="prescriptionform" method="post"  action="prescription_new.html" data-parsley-validate="" class="form-horizontal form-label-left"> {% csrf_token %}

                      <div class="form-group" style="display:none;">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="ccode">Patient ID <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <input type="text" id="ccode" name="ccode" value="{{patientID}}"  class="form-control col-md-7 col-xs-12" readonly>
                        </div>
                      </div>
                      <div class="form-group" style="display:none;">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">Name <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <input type="text" id="name" name="name" value="{{patientname}}" class="form-control col-md-7 col-xs-12" readonly>
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="control-label col-md-2 col-sm-2 col-xs-12" for="name">Height
                        </label>
                        <div class="col-md-2 col-sm-2 col-xs-12">
                          <input id="height" name="height" data-parsley-type="digits" data-parsley-trigger="change" class="form-control col-md-7 col-xs-12" placeholder="cm" />
                        </div>
                        <label class="control-label col-md-2 col-sm-2 col-xs-12" for="name">Weight
                        </label>
                        <div class="col-md-2 col-sm-2 col-xs-12">
                          <input type="text" id="weight" name="weight" data-parsley-trigger="change"  class="form-control col-md-7 col-xs-12" placeholder="Kg">
                        </div>
                      </div>

                      <div class="form-group">
                            <label class="control-label col-md-2 col-sm-2 col-xs-12">Diagnosis <span class="required">*</span></label>
                            <div class="col-md-8 col-sm-8 col-xs-12">
                              <textarea id="diagnosis" name="diagnosis" class="form-control col-md-8 col-xs-12" rows="6" required="required" ></textarea>
                            </div>

                      </div>

                      <div class="form-group">
                            <label class="control-label col-md-2 col-sm-2 col-xs-12">Clinical examination </label>
                            <div class="col-md-8 col-sm-8 col-xs-12">
                              <textarea id="procedure" name="procedure" class="form-control col-md-8 col-xs-12" rows="6" ></textarea>
                            </div>
                      </div>

                      <div class="form-group">
                            <label class="control-label col-md-2 col-sm-2 col-xs-12">Treatment suggested</label>
                            <div class="col-md-8 col-sm-8 col-xs-12">
                              <textarea id="treatmentsuggested" name="treatmentsuggested" class="form-control col-md-8 col-xs-12" rows="6" ></textarea>
                            </div>
                      </div>

                      <div class="form-group">
                            <label class="control-label col-md-2 col-sm-2 col-xs-12">Medication</label>
                            <div class="col-md-8 col-sm-8 col-xs-12">
                              <textarea id="medications" name="medications" class="form-control col-md-8 col-xs-12" rows="6" ></textarea>
                            </div>
                      </div>

                      <div class="form-group">
                            <label class="control-label col-md-2 col-sm-2 col-xs-12">Diet Advise</label>
                            <div class="col-md-8 col-sm-8 col-xs-12">
                              <textarea id="dietadvice" name="dietadvice" class="form-control col-md-8 col-xs-12" rows="6" ></textarea>
                            </div>
                      </div>

                      <div class="form-group">
                            <label class="control-label col-md-2 col-sm-2 col-xs-12">Advise on discharge</label>
                            <div class="col-md-8 col-sm-8 col-xs-12">
                              <textarea id="advice" name="advice" class="form-control col-md-8 col-xs-12" rows="6" ></textarea>
                            </div>
                      </div>

                      <div class="form-group">
                         <label class="control-label col-md-2 col-sm-2 col-xs-12">Follow up date </label>
                            <div class="col-md-2">
                              <div class="checkbox">
                                <label class="">
                                  <input id="followup" name="followup" class="flat" checked="checked" onchange='handleChange(this);' type="checkbox">Follow up
                                </label>
                              </div>
                              <script>
                                  function handleChange(checkbox) {
                                      document.getElementById("single_cal1").value = (checkbox.checked ? moment().format('MM/DD/YYYY') :  '');
                                      document.getElementById("single_cal1").disabled = !(checkbox.checked);

                                  }
                              </script>
                            </div>
                            <div class="col-md-4">
                                   <div class="daterangepicker dropdown-menu ltr single opensright show-calendar picker_1 xdisplay"><div class="calendar left single" style="display: block;"><div class="daterangepicker_input"><input class="input-mini form-control active" type="text" name="daterangepicker_start" value="" style="display: none;"><i class="fa fa-calendar glyphicon glyphicon-calendar" style="display: none;"></i><div class="calendar-time" style="display: none;"><div></div><i class="fa fa-clock-o glyphicon glyphicon-time"></i></div></div><div class="calendar-table"><table class="table-condensed"><thead><tr><th class="prev available"><i class="fa fa-chevron-left glyphicon glyphicon-chevron-left"></i></th><th colspan="5" class="month">Oct 2016</th><th class="next available"><i class="fa fa-chevron-right glyphicon glyphicon-chevron-right"></i></th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead><tbody><tr><td class="weekend off available" data-title="r0c0">25</td><td class="off available" data-title="r0c1">26</td><td class="off available" data-title="r0c2">27</td><td class="off available" data-title="r0c3">28</td><td class="off available" data-title="r0c4">29</td><td class="off available" data-title="r0c5">30</td><td class="weekend available" data-title="r0c6">1</td></tr><tr><td class="weekend available" data-title="r1c0">2</td><td class="available" data-title="r1c1">3</td><td class="available" data-title="r1c2">4</td><td class="available" data-title="r1c3">5</td><td class="available" data-title="r1c4">6</td><td class="available" data-title="r1c5">7</td><td class="weekend available" data-title="r1c6">8</td></tr><tr><td class="weekend available" data-title="r2c0">9</td><td class="available" data-title="r2c1">10</td><td class="available" data-title="r2c2">11</td><td class="available" data-title="r2c3">12</td><td class="available" data-title="r2c4">13</td><td class="available" data-title="r2c5">14</td><td class="weekend available" data-title="r2c6">15</td></tr><tr><td class="weekend available" data-title="r3c0">16</td><td class="available" data-title="r3c1">17</td><td class="today active start-date active end-date available" data-title="r3c2">18</td><td class="available" data-title="r3c3">19</td><td class="available" data-title="r3c4">20</td><td class="available" data-title="r3c5">21</td><td class="weekend available" data-title="r3c6">22</td></tr><tr><td class="weekend available" data-title="r4c0">23</td><td class="available" data-title="r4c1">24</td><td class="available" data-title="r4c2">25</td><td class="available" data-title="r4c3">26</td><td class="available" data-title="r4c4">27</td><td class="available" data-title="r4c5">28</td><td class="weekend available" data-title="r4c6">29</td></tr><tr><td class="weekend available" data-title="r5c0">30</td><td class="available" data-title="r5c1">31</td><td class="off available" data-title="r5c2">1</td><td class="off available" data-title="r5c3">2</td><td class="off available" data-title="r5c4">3</td><td class="off available" data-title="r5c5">4</td><td class="weekend off available" data-title="r5c6">5</td></tr></tbody></table></div></div><div class="calendar right" style="display: none;"><div class="daterangepicker_input"><input class="input-mini form-control" type="text" name="daterangepicker_end" value="" style="display: none;"><i class="fa fa-calendar glyphicon glyphicon-calendar" style="display: none;"></i><div class="calendar-time" style="display: none;"><div></div><i class="fa fa-clock-o glyphicon glyphicon-time"></i></div></div><div class="calendar-table"><table class="table-condensed"><thead><tr><th></th><th colspan="5" class="month">Nov 2016</th><th class="next available"><i class="fa fa-chevron-right glyphicon glyphicon-chevron-right"></i></th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead><tbody><tr><td class="weekend off available" data-title="r0c0">30</td><td class="off available" data-title="r0c1">31</td><td class="available" data-title="r0c2">1</td><td class="available" data-title="r0c3">2</td><td class="available" data-title="r0c4">3</td><td class="available" data-title="r0c5">4</td><td class="weekend available" data-title="r0c6">5</td></tr><tr><td class="weekend available" data-title="r1c0">6</td><td class="available" data-title="r1c1">7</td><td class="available" data-title="r1c2">8</td><td class="available" data-title="r1c3">9</td><td class="available" data-title="r1c4">10</td><td class="available" data-title="r1c5">11</td><td class="weekend available" data-title="r1c6">12</td></tr><tr><td class="weekend available" data-title="r2c0">13</td><td class="available" data-title="r2c1">14</td><td class="available" data-title="r2c2">15</td><td class="available" data-title="r2c3">16</td><td class="available" data-title="r2c4">17</td><td class="available" data-title="r2c5">18</td><td class="weekend available" data-title="r2c6">19</td></tr><tr><td class="weekend available" data-title="r3c0">20</td><td class="available" data-title="r3c1">21</td><td class="available" data-title="r3c2">22</td><td class="available" data-title="r3c3">23</td><td class="available" data-title="r3c4">24</td><td class="available" data-title="r3c5">25</td><td class="weekend available" data-title="r3c6">26</td></tr><tr><td class="weekend available" data-title="r4c0">27</td><td class="available" data-title="r4c1">28</td><td class="available" data-title="r4c2">29</td><td class="available" data-title="r4c3">30</td><td class="off available" data-title="r4c4">1</td><td class="off available" data-title="r4c5">2</td><td class="weekend off available" data-title="r4c6">3</td></tr><tr><td class="weekend off available" data-title="r5c0">4</td><td class="off available" data-title="r5c1">5</td><td class="off available" data-title="r5c2">6</td><td class="off available" data-title="r5c3">7</td><td class="off available" data-title="r5c4">8</td><td class="off available" data-title="r5c5">9</td><td class="weekend off available" data-title="r5c6">10</td></tr></tbody></table></div></div><div class="ranges" style="display: none;"><div class="range_inputs"><button class="applyBtn btn btn-sm btn-success" type="button">Apply</button> <button class="cancelBtn btn btn-sm btn-default" type="button">Cancel</button></div></div></div>
                                    <fieldset>
                                      <div class="control-group">
                                        <div class="controls">
                                          <div class="col-md-11 xdisplay_inputx form-group has-feedback">
                                            <input type="text" class="form-control has-feedback-left" id="single_cal1" name="followupdate" placeholder="Follow up date" aria-describedby="inputSuccess2Status">
                                            <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                                            <span id="inputSuccess2Status" class="sr-only">(success)</span>
                                          </div>
                                        </div>
                                      </div>
                                    </fieldset>

                                  </div>
                      </div>

                      <div class="form-group">
                        <label class="control-label col-md-2 col-sm-2 col-xs-12">Consultation fees</label>
                        <div class="col-md-8 col-sm-8 col-xs-12">
                          <input id="cfees" name="cfees" data-parsley-type="digits" data-parsley-trigger="change" class="form-control col-md-7 col-xs-12">
                        </div>
                      </div>


                      <div class="form-group">
                            <label class="control-label col-md-2 col-sm-2 col-xs-12">Prescribe</label>
                             <div class="col-md-2 col-sm-2 col-xs-12">
                                 <select id="type1" name="type1" onchange="change(this,1)" class="form-control">
                                   <option value="Medicine">Medicine</option>
                                   <option value="Package">Package</option>
                                   <option value="Service">Service</option>
                                   <option value="Treatment">Treatment</option>
                                 </select>
                             </div>
                             <div class="col-md-2 col-sm-2 col-xs-12">
                                 <select id="medicine1" name="medicine1" onchange="checkstock(this,1)" class="form-control">
                                   {% for s in medicine %}
                                   <option value="{{s.id}}">{{s.item_name}}</option>
                                   {% endfor %}
                                 </select>
                             </div>
                              <div class="col-md-1 col-sm-1 col-xs-12">
                                 <input type="text" id="quantity1" name="quantity1" placeholder="No." class="form-control col-md-1 col-xs-12">
                              </div>
                              <div class="col-md-4 col-sm-4 col-xs-12">
                                 <textarea id="dosage1" name="dosage1" placeholder="Details/Dosage" class="form-control col-md-4 col-xs-12" style="margin-bottom:10px;" rows="4"></textarea>
                              </div>
                              <div class="col-md-1 col-sm-1 col-xs-2">
                                <a href="javascript:void(0);" id="1" onclick="addFields(this.id)"><i class="fa fa-plus-circle" style="font-size:20px;" aria-hidden="true"></i></a>
                              </div>

                      </div>


                        <div class="actionBar">
                            <button class="buttonNext btn btn-success" type="submit">Finish</button>
                        </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
{% endif %}

{% if notmyfranchise %}
    {% include "app/mydir/common/verificationmodal.html" %}
    <script>
        $( document ).ready(function() {
            $("#verificationModal").modal();
        });
    </script>
{% endif %}

<script type='text/javascript'>
        function addFields(id){
            d = document.getElementById(id);
            d.parentNode.removeChild(d);
            id = (parseInt(id)+1).toString();
            container = '<div class="form-group"> \
                                <label class="control-label col-md-2 col-sm-2 col-xs-12">Prescribe</label> \
                                <div class="col-md-2 col-sm-2 col-xs-12"> \
                                 <select id="type'+id+'" name="type'+id+'" onchange="change(this,'+id+')" class="form-control"> \
                                   <option value="Medicine">Medicine</option> \
                                   <option value="Package">Package</option> \
                                   <option value="Service">Service</option> \
                                   <option value="Treatment">Treatment</option> \
                                 </select> \
                             </div> \
                            <div class="col-md-2 col-sm-2 col-xs-12"> \
                                 <select id="medicine'+id+'" name="medicine'+id+'" class="form-control" onchange="checkstock(this,'+id+')"> \
                                   {% for s in medicine %} \
                                   <option value="{{s.id}}">{{s.item_name}}</option> \
                                   {% endfor %} \
                                 </select> \
                             </div> \
                              <div class="col-md-1 col-sm-1 col-xs-12"> \
                                 <input type="text" id="quantity'+id+'" name="quantity'+id+'" placeholder="No." class="form-control col-md-1 col-xs-12"> \
                              </div> \
                              <div class="col-md-4 col-sm-4 col-xs-12"> \
                                 <textarea id="dosage'+id+'" name="dosage'+id+'" placeholder="Details/Dosage" class="form-control col-md-4 col-xs-12" style="margin-bottom:10px;" rows="4"></textarea>  \
                              </div> \
                              <div class="col-md-1 col-sm-1 col-xs-2"> \
                                <a href="javascript:void(0);" id="'+id+'" onclick="addFields(this.id)"><i class="fa fa-plus-circle" style="font-size:20px;" aria-hidden="true"></i></a> \
                              </div> \
                              </div>';
            $(container).insertBefore('div.actionBar');
        }

   function checkstock(obj,num){
        var optionSelected = $("option:selected", obj)[0].innerHTML;
        var valueSelected = obj.value;
        if(document.getElementById('type'+num.toString()).value!='Medicine')
            return;

        $.ajax({
        url: '/ajax/checkstock/',
        data: {
          'id': valueSelected
        },
        dataType: 'json',
        success: function (data) {
                if(data['success']==0)
                {
                    new PNotify({
                      title: 'Warning',
                      text: 'The item '+optionSelected+' is out of stock.',
                      type: 'error',
                      styling: 'bootstrap3'
                  });
                 }
                 else if(data['success']==1)
                 {
                        new PNotify({
                                  title: 'Note',
                                  text: 'Item: '+optionSelected+'\<br> Batch No: '+data['batches'][0]+'\<br> Stock Quantity available: '+data['counts'][0].toString(),
                                  type: 'info',
                                  styling: 'bootstrap3'
                        });
                 }

            }
        });

        }

    function change(obj,num) {
          var meta = obj.value;
          if (obj.value!="Medicine")
          { document.getElementById('quantity'+String(num)).value = 1; document.getElementById('quantity'+String(num)).readOnly = true; }
          else
          { document.getElementById('quantity'+String(num)).value = ''; document.getElementById('quantity'+String(num)).readOnly = false; }
          $.ajax({
            url: '/ajax/getlist/',
            data: {
              'meta': meta,
            },
            dataType: 'json',
            success: function (data) {
                var b = "";
                if (obj.value=="Medicine"){
                    for (var j = 0; j < data.services.length; j++) {
                            var s = '<option value="'+ data.services[j][1] +'">'+ data.services[j][0] +'</option>';
                            b = b+s;
                    }
                }
                else {
                    for (var j = 0; j < data.services.length; j++) {
                        var s = '<option value="' + data.services[j] + '">' + data.services[j] + '</option>';
                        b = b + s;

                    }
                }
                document.getElementById("medicine"+num.toString()).innerHTML = b;

            }
          });
    }

    $("#single_cal1").on("change", function() {
     if (moment($(this).val()) <= moment().add(-1,'days'))
        {  alert("The date you have selected is in the past. Please select another date." );
           $("#single_cal1").val(moment().format('MM/DD/YYYY'));
        }
    });

</script>